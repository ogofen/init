#!/bin/bash
### monitor vdsm-host

export flag=$(which ack)
if [ ! $flag ]; then
	echo ack command has not been found,exiting...
	echo please install ack package via \"yum install ack\"
	exit
fi

export IP="$(ifconfig | grep -A 1 'rhevm' | tail -1 | cut -d ':' -f 2 | cut -d ' ' -f 1)"
if [ ! $IP ]; then
	export IP="$(ifconfig | grep -A 1 'ovirtmgmt' | tail -1 | cut -d ':' -f 2 | cut -d ' ' -f 1)"
fi
if [ ! $IP ]; then
	export IP="$(ifconfig | grep -A 1 'eth0' | tail -1 | cut -d ':' -f 2 | cut -d ' ' -f 1)"
fi

echo initializing, please wait a moment... 
echo "(today's tip: black backgroud)"

rm -r /root/.msyntax > /dev/null 2>&1
rm /root/pipe > /dev/null 2>&1
touch /root/pipe
mkdir /root/.msyntax > /dev/null 2>&1
cd /root/.msyntax/
wget -O .regular.txt  https://www.dropbox.com/s/m6wpwqqfjzthyyt/regular.txt > /dev/null 2>&1
wget -O .Ok.txt https://www.dropbox.com/s/obtwt29a3kjeyg9/Ok.txt > /dev/null 2>&1
wget -O .files.txt https://www.dropbox.com/s/h4e8q02l8sngkir/files.txt > /dev/null 2>&1
wget -O .Err.txt https://www.dropbox.com/s/aw4y7xzkaizhwh3/Err.txt > /dev/null 2>&1
wget -O .class.txt https://www.dropbox.com/s/mf149otykts4bkj/class.txt > /dev/null 2>&1

printf "\n\n"
echo monitoring host:$IP

wget -O .engineAPI.txt https://www.dropbox.com/s/hn6o6pk70d8sftg/engineAPI.txt > /dev/null 2>&1

cd ..
echo thanx for using "ogofen's" monitor script

export FUNC=$(cat /root/.msyntax/.engineAPI.txt)
export ERR=$(cat /root/.msyntax/.Err.txt)
export OK=$(cat /root/.msyntax/.Ok.txt)
export CLASS=$(cat /root/.msyntax/.class.txt)
export FILE=$(cat /root/.msyntax/.files.txt)
export REG=$(cat /root/.msyntax/.regular.txt)

pkill -9 tail
tail -f /var/log/ovirt-engine/engine.log|ack --passthru --color  "$FUNC" --color-match="bold green"|ack --passthru --color  "$ERR" --color-match="bold red"|ack --passthru --color  "$OK" --color-match="bold yellow" #|ack --passthru --color  "$CLASS" --color-match="bold cyan"|ack --passthru --color  "$FILE" --color-match="bold magenta"|ack --passthru --color  "$REG" --color-match="bold yellow"
#tail -f pipe|ack --passthru --color  "$FUNC" --color-match="bold green"|ack --passthru --color  "$ERR" --color-match="bold red" #|ack --passthru --color  "$OK" --color-match="bold white"|ack --passthru --color  "$CLASS" --color-match="bold cyan" #|ack --passthru --color  "$FILE" --color-match="bold magenta"|ack --passthru --color  "$REG" --color-match="bold yellow"

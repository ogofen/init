#!/bin/bash
### monitor vdsm-host

export flag=$(which ack)
if [ ! $flag ]; then
	echo ack command has not been found,exiting...
	echo please install ack package via \"yum install ack\"
	exit
fi
export flag1=$(which git)
if [ ! $flag1 ]; then
	echo git software has not been found,exiting...
	echo please install git package via \"yum install git\"
	exit
fi
export IP="$(ifconfig | grep -A 1 'rhevm' | tail -1 | cut -d ':' -f 2 | cut -d ' ' -f 1)"
if [ ! $IP ]; then
	export IP="$(ifconfig | grep -A 1 'ovirtmgmt' | tail -1 | cut -d ':' -f 2 | cut -d ' ' -f 1)"
fi

echo initializing, please wait a moment... 
echo "(today's tip: black backgroud)"

rm -r /root/.msyntax > /dev/null 2>&1
rm /root/pipe > /dev/null 2>&1
git clone https://github.com/ogofen/msyntax.git /root/.msyntax

printf "\n\n"
echo monitoring host:$IP

echo thanx for using "ogofen's" monitor script

export FUNC=$(cat /root/.msyntax/._vdsmAPI.txt)
export ERR=$(cat /root/.msyntax/.Err.txt)
export OK=$(cat /root/.msyntax/.Ok.txt)
export CLASS=$(cat /root/.msyntax/.class.txt)
export FILE=$(cat /root/.msyntax/.files.txt)
export REG=$(cat /root/.msyntax/.regular.txt)

pkill -9 tail
tail -s .5 -n 10 -f /var/log/vdsm/vdsm.log>pipe &
tail -f pipe|ack --passthru --color  "$FUNC" --color-match="bold green"|ack --passthru --color  "$ERR" --color-match="bold red"|ack --passthru --color  "$OK" --color-match="bold white"|ack --passthru --color  "$CLASS" --color-match="bold cyan"|ack --passthru --color  "$FILE" --color-match="bold magenta"|ack --passthru --color  "$REG" --color-match="bold yellow"


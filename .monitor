#!/bin/bash
### monitor vdsm-host

export flag=$(which ack)
if [ ! $flag ]; then
	echo ack command has not been found,exiting...
	echo please install ack package via \"yum install ack\"
	exit
fi

export IP="$(ifconfig | grep -A 1 'rhevm' | tail -1 | cut -d ':' -f 2 | cut -d ' ' -f 1)"
if [ ! $IP ]; then
	export IP="$(ifconfig | grep -A 1 'ovirtmgmt' | tail -1 | cut -d ':' -f 2 | cut -d ' ' -f 1)"
fi

echo initializing, please wait a moment... 
echo "(today's tip: black backgroud)"

rm -r /root/.msyntax > /dev/null 2>&1
rm /root/pipe > /dev/null 2>&1
mkdir /root/.msyntax > /dev/null 2>&1
cd /root/.msyntax/
wget -O .regular.txt https://www.dropbox.com/s/o9pbi409rg0zp2i/regular.txt > /dev/null 2>&1
wget -O .Ok.txt https://www.dropbox.com/s/41965gtgnqazqjz/Ok.txt > /dev/null 2>&1
wget -O .files.txt https://www.dropbox.com/s/p9xj3pxtby7f4gq/files.txt > /dev/null 2>&1
wget -O .Err.txt https://www.dropbox.com/s/iiswibpg9ku4feh/Err.txt > /dev/null 2>&1
wget -O .class.txt https://www.dropbox.com/s/tz8elfqzuo4solp/class.txt > /dev/null 2>&1

printf "\n\n"
echo monitoring host:$IP

wget -O ._vdsmAPI.txt https://www.dropbox.com/s/phqw8b0nogtna3j/_vdsmAPI.txt > /dev/null 2>&1

cd ..
echo thanx for using "ogofen's" monitor script

export FUNC=$(cat /root/.msyntax/._vdsmAPI.txt)
export ERR=$(cat /root/.msyntax/.Err.txt)
export OK=$(cat /root/.msyntax/.Ok.txt)
export CLASS=$(cat /root/.msyntax/.class.txt)
export FILE=$(cat /root/.msyntax/.files.txt)
export REG=$(cat /root/.msyntax/.regular.txt)

pkill -9 tail
tail -s .5 -n 10 -f /var/log/vdsm/vdsm.log>pipe &
tail -f pipe|ack --passthru --color  "$FUNC" --color-match="bold green"|ack --passthru --color  "$ERR" --color-match="bold red"|ack --passthru --color  "$OK" --color-match="bold white"|ack --passthru --color  "$CLASS" --color-match="bold cyan"|ack --passthru --color  "$FILE" --color-match="bold magenta"|ack --passthru --color  "$REG" --color-match="bold yellow"

